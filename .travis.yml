language: rust
cache: cargo
matrix:
  include:
    - rust: stable
      install: true
      script:
        - cargo test --manifest-path crates/server/Cargo.toml
        - cargo test --manifest-path crates/shared/Cargo.toml
    - rust: beta
      install: true
      script:
        - cargo test --manifest-path crates/server/Cargo.toml
        - cargo test --manifest-path crates/shared/Cargo.toml
    - rust: nightly
      install: true
      before_install:
        - rustup target add --toolchain nightly wasm32-unknown-unknown
        - nvm install 10
      before_script: cargo install wasm-bindgen-cli --force
      script:
        - cargo test --manifest-path crates/browser/Cargo.toml
        - cargo +nightly build --target wasm32-unknown-unknown --manifest-path crates/browser/Cargo.toml
        - wasm-bindgen ./target/wasm32-unknown-unknown/debug/wasm_tutorial_browser.wasm --out-dir .
        - mv ./wasm_tutorial_browser.wasm ./ts/bincode_parse.wasm
        - webpack

env: RUST_BACKTRACE=1
notifications:
  - email: false
branches:
  only:
  - master