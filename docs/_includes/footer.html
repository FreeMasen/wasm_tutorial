{% if page.readings %}
<div class="explain" style="width:500px;margin:auto;display:flex;flex-flow:column;align-items:first-baseline">
<span style="font-weight:bold;">Additional Reading</span>
<hr style="width:100%;border:0;border-bottom:1px solid #e8e8e8;" />
{% for reading in page.readings %}
<div class="reading">
    <span style="font-weight:bold;">[{{ forloop.index0 }}]</span>
    <a href="{{reading.url}}">{{reading.text}}</a>
</div>
{% endfor %}
</div>
{% endif %}
<footer style="width:100%;height:50px;display:flex;flex-flow:row;justify-content:space-around;">
    {% if page.prev %}
    <a id="previous-page" href="{{page.prev.url | relative_url}}">{{page.prev.text}}</a>
    {% else %}
    <div></div>
    {% endif %}
    {% if page.next %}
    <a id="next-page" href="{{page.next.url | relative_url}}">{{page.next.text}}</a>
    {% else %}
    <div></div>
    {% endif %}
</footer>
<script>
    'use strict';
    window.addEventListener('DOMContentLoaded', checkForPresentation);
    function checkForPresentation() {
        if (location.search.indexOf('presenting=true') > -1) {
            removeExplains();
            updateLinks();
            addArrowHandlers();
            getNotes();
        } else {
            removePresenting();
        }
    }

    function addArrowHandlers() {
        window.addEventListener('keyup', ev => {
            switch (ev.key) {
                case 'ArrowRight':
                    return goToLink('next-page');
                case 'ArrowLeft':
                    return goToLink('previous-page');
            }
        });
    }

    function goToLink(id) {
        let a = document.getElementById(id);
        if (!a) return;
        window.location.assign(a.href);
    }

    function removeExplains() {
        removeClass('.explain');
    }

    function updateLinks() {
        let links = document.getElementsByTagName('a');
        for (var i = 0; i < links.length; i++) {
            links[i].href = links[i].href+'?presenting=true';
        }
    }

    function removePresenting() {
        removeClass('.presenting')
    }

    function removeClass(cls) {
        let elements = document.querySelectorAll(cls);
        for (var i = 0; i < elements.length; i++) {
            elements[i].parentElement.removeChild(elements[i]);
        }
    }

    function getNotes() {
        let current = window.location.pathname;
        let parts = current.split("/");
        let stepsIdx = parts.indexOf('steps');
        if (stepsIdx < 0) return console.error('tried to get notes for a non-steps page');
        parts[stepsIdx] = 'notes';
        let url = parts.join('/');
        let jsonUrl = url.substr(0, url.length - 4) + 'json';
        fetch(jsonUrl).then(res => {
            res.json().then(json => {
                console.log(json.title);
                console.log('----------')
                printNotes(json.notes);
            })
            .catch(e => console.error('json error', e));
        })
        .catch(e => console.error('fetch error', e));
    }
    function printNotes(notes, indent = 0) {
        for (var i = 0; i < notes.length;i++) {
            let note = notes[i];
            printNote(note.title, indent);
            if (note.subNotes) {
                printNotes(note.subNotes, indent + 1);
            }
        }
    }
    function printNote(note, indent) {
        console.log(`${'    '.repeat(indent)}- ${note}`);
    }
</script>
{% if page.js %}
<script src={{page.js | relative_url}} type="text/javascript"></script>
{% endif%}
<style>
    .wrapper { 
        max-width: 910px !important; 
    }
    .highlighter-rouge {
        display: inline-block;
        padding-bottom: 10px;
        padding-top: 10px;
        min-width: 460px;
    }
</style>